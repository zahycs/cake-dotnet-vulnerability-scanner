// Install latest Cake.VulnerabilityScanner as a Cake Addin,recommended to use a specific version
#addin nuget:?package=Cake.VulnerabilityScanner 

var target = Argument("target", "ScanPackages"); 

//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////



Task("ScanPackages") 
    .Does( async () =>
{
            var ossIndexToken = Environment.GetEnvironmentVariable("OSS_INDEX_TOKEN");
            await  ScanPackagesAsync(new ScanPackagesSettings
            {
                Ecosystem="nuget",
                FailOnVulnerability=false,
                OssIndexBaseUrl="https://ossindex.sonatype.org/",
                OssIndexToken=ossIndexToken,
                SolutionFile="../../Cake.VulnerabilityScanner.sln",
                Verbosity= Microsoft.Extensions.Logging.LogLevel.Debug
            }, System.Threading.CancellationToken.None);
});


//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);

// To run it make sure you have the cake tool installed and run this `dotnet cake --nuget_loaddependencies=true`